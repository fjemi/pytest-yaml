globals:
  resources:
  - ${ROOT_DIR}/assertions/app.py


tests:
- function: main
  description: >
    Sets the environment within the global variable CONFIG
    of a module. Only works within the framework where
    the environment is accessed through sh`CONFIG.environment`.
  cast_arguments:
  - field: module
    caster: test_resources.app.module_resource
  tests:
  - description: Undefined arguments
    arguments:
      environment: null
      module: null
    assertions:
    - method: assertions.app.assert_equals
      expected: {}
  - description: CONFIG has environment attribute
    arguments:
      environment:
        VARIABLE_A: VALUE_A
        VARIABLE_B: VALUE_B
      module: config_environment_does_exist
    assertions:
    - method: assertions.app.assert_equals
      field: module.CONFIG.environment.VARIABLE_A
      expected: VALUE_A
    - method: assertions.app.assert_equals
      field: module.CONFIG.environment.VARIABLE_B
      expected: VALUE_B
    - method: assertions.app.assert_equals
      field: module.CONFIG.environment.VARIABLE_C
      expected: VALUE_C
  - description: CONFIG doesn't have environment attribute
    arguments:
      environment:
        VARIABLE_A: VALUE_A
        VARIABLE_B: VALUE_B
      module: config_environment_does_not_exist
    assertions:
    - method: assertions.app.assert_equals
      field: module.CONFIG.environment.VARIABLE_A
      expected: VALUE_A
    - method: assertions.app.assert_equals
      field: module.CONFIG.environment.VARIABLE_B
      expected: VALUE_B
